<script>
    async function plotGraph() {
        const functionInput = document.getElementById('id_functionInput').value.trim();
        if (!functionInput) {
            document.getElementById('errorMessage').innerText = "Por favor, ingresa una función válida.";
            return;
        }
        try {
            const response = await fetch(`/generate_plot_data/?function=${encodeURIComponent(functionInput)}`);
            const data = await response.json();
            if (data.error) {
                document.getElementById('errorMessage').innerText = data.error;
                return;
            }

            // Renderizar el gráfico con Plotly
            const trace = {
                x: data.x,
                y: data.y,
                mode: 'lines',
                line: { color: 'rgba(75, 192, 192, 1)', width: 2 },
                name: `y = ${data.function}`
            };
            const layout = {
                title: `Gráfica de y = ${data.function}`,
                xaxis: { title: 'x', showgrid: true, gridcolor: '#444', zeroline: true },
                yaxis: { title: 'y', showgrid: true, gridcolor: '#444', zeroline: true },
                plot_bgcolor: '#1e1e1e',
                paper_bgcolor: '#2c2c2c',
                font: { color: 'white' }
            };

            Plotly.newPlot('chart', [trace], layout);
            document.getElementById('errorMessage').innerText = "";
        } catch (error) {
            document.getElementById('errorMessage').innerText = "Hubo un error al generar la gráfica.";
        }
    }
</script>

<input type="text" id="functionInput" class="form-control" placeholder="e.g., x**2 - 4" oninput="plotGraph()">
