<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráfica de Función - Plano Cartesiano</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #1e1e1e;
            color: white;
            font-family: Arial, sans-serif;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 900px;
            text-align: center;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 15px;
            background-color: #2c2c2c;
        }

        canvas {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        input, button {
            margin-top: 10px;
        }

        .chart-container {
            position: relative;
            height: 500px;
            width: 100%;
        }

        #coordinates {
            margin-top: 10px;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Graficador de Función con Coordenadas</h1>
        <p>Ingresa una función matemática válida (por ejemplo, <code>x**2</code>, <code>Math.sin(x)</code>, etc.)</p>
        <input type="text" id="functionInput" class="form-control" placeholder="Ingresa la función (e.g., x**3 + 2*x)">
        <button id="plotButton" class="btn btn-primary mt-2">Graficar</button>
        <div class="chart-container mt-4">
            <canvas id="chart"></canvas>
        </div>
        <div id="coordinates">Haz clic en el gráfico para ver las coordenadas.</div>
    </div>

    <script>
        const ctx = document.getElementById('chart').getContext('2d');
        let chart;

        document.getElementById('plotButton').addEventListener('click', () => {
            const functionInput = document.getElementById('functionInput').value;

            if (!functionInput) {
                alert("Por favor, ingresa una función válida.");
                return;
            }

            // Generar puntos para la gráfica
            const xValues = [];
            const yValues = [];
            const step = 0.1; // Incremento de x
            const range = 10; // Rango de -10 a 10

            for (let x = -range; x <= range; x += step) {
                xValues.push(x);

                try {
                    const y = eval(functionInput.replace(/x/g, `(${x})`).replace(/\^/g, "**"));
                    yValues.push(y);
                } catch (e) {
                    alert("Error en la función. Asegúrate de usar un formato válido.");
                    return;
                }
            }

            // Destruir la gráfica existente si la hay
            if (chart) {
                chart.destroy();
            }

            // Crear la nueva gráfica
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: xValues,
                    datasets: [{
                        label: `y = ${functionInput}`,
                        data: yValues,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4, // Curvatura de la línea
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Gráfica de Función con Coordenadas',
                            font: { size: 18, weight: 'bold' },
                            color: '#ffffff'
                        },
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { size: 14 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x',
                                color: '#ffffff',
                                font: { size: 16, weight: 'bold' }
                            },
                            grid: {
                                color: '#444',
                                drawOnChartArea: true, // Mostrar cuadrícula
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: (value) => value.toFixed(1) // Limitar a 1 decimal
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'y',
                                color: '#ffffff',
                                font: { size: 16, weight: 'bold' }
                            },
                            grid: {
                                color: '#444',
                                drawOnChartArea: true, // Mostrar cuadrícula
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: (value) => value.toFixed(1) // Limitar a 1 decimal
                            }
                        }
                    },
                    // Función para dibujar la cruz en el centro
                    annotation: {
                        annotations: [
                            {
                                type: 'line',
                                mode: 'horizontal',
                                scaleID: 'y',
                                value: 0,
                                borderColor: '#ffffff',
                                borderWidth: 1,
                                label: {
                                    content: '0',
                                    enabled: true,
                                    position: 'center',
                                    font: { size: 14, weight: 'bold' },
                                    color: '#ffffff'
                                }
                            },
                            {
                                type: 'line',
                                mode: 'vertical',
                                scaleID: 'x',
                                value: 0,
                                borderColor: '#ffffff',
                                borderWidth: 1,
                                label: {
                                    content: '0',
                                    enabled: true,
                                    position: 'center',
                                    font: { size: 14, weight: 'bold' },
                                    color: '#ffffff'
                                }
                            }
                        ]
                    },
                    onClick: (e, activeElements) => {
                        // Obtener coordenadas del clic
                        const chartArea = chart.chartArea;
                        const x = e.offsetX;
                        const y = e.offsetY;

                        if (x >= chartArea.left && x <= chartArea.right && y >= chartArea.top && y <= chartArea.bottom) {
                            const xValue = chart.scales.x.getValueForPixel(x);
                            const yValue = chart.scales.y.getValueForPixel(y);
                            document.getElementById('coordinates').innerText = `(${xValue.toFixed(2)}, ${yValue.toFixed(2)})`;
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>